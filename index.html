<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Itim&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <title>RelaxMe</title>
  </head>
  <body>
    <div id="landscape" class="landscape">
      <video id="lsVideo" loop muted autoplay poster="img/preview_water.jpg" class="fullscreen-landscape">
        <source src="img/water.mp4" type="video/mp4">
      </video>
      <div id="player" class="centered-content player d-none">
        <button type="button" class="btn togglePlayButton" onclick="pauseVideo();"><img id="togglePlayButton" src="img/pause.png"></button>
        <button type="button" class="btn nextButton"><img src="img/next.png"></button>
      </div>
      <div class="infoMenu">
        <button id="menuButton" type="button" class="btn"><img src="img/menu.png" onclick="menuFunction();"></button>
      </div>
    </div>
    <div id="info" class="container info d-flex">
      <button id="playButton" class="btn play-button centered-content" onclick="playFunction();return false;">Relax me!</button>
      <div class="row justify-content-center align-self-center w-100">
        <div class="col-sm-6">
          <div id="infoMusic" class="infoMusic text-center d-none">
            Music
          </div>
          <div id="sectionMusic"></div>
        </div>
        <div class="col-sm-6">
          <div id="infoFx" class="infoMusic text-center d-none">
            Ambience
          </div>
          <div id="sectionFx"></div>
        </div>
      </div>
      <div id="lsButton" class="goToLandscape d-none">
        <button type="button" class="btn"><img src="img/house.png" onclick="lsFunction();"></button>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    var info = document.getElementById("info");
    var landscape = document.getElementById("landscape");
    var playButton = document.getElementById("playButton");
    var menuButton = document.getElementById("menuButton");
    var lsVideo = document.getElementById("lsVideo");
    var timer;
    var fadeInBuffer = false;
    var isPlayingVideo = true;

    function menuFunction() {
      info.classList.remove('opacity-off');
      info.classList.add('opacity-on');
      landscape.classList.remove('opacity-on');
    }

    function lsFunction() {
      landscape.classList.add('opacity-on');
      info.classList.remove('opacity-on');
      info.classList.add('opacity-off');
    }

    $(document).mousemove(function(){
      if(!fadeInBuffer){
        if(timer){
          clearTimeout(timer);
          timer = 0;
        }
      } else {
        landscape.classList.remove('hide-cursor');
        $("#menuButton").css("opacity", "");
        $(".togglePlayButton").css("opacity", "");
        $(".nextButton").css("opacity", "");
        fadeInBuffer = false;
      }
    timer = setTimeout(
      function(){
        if(isPlayingVideo){
          if($('.btn:hover').length == 0){
            landscape.classList.add('hide-cursor');
            $("#menuButton").css("opacity", 0);
            $(".togglePlayButton").css("opacity", 0);
            $(".nextButton").css("opacity", 0);
            fadeInBuffer = true;
          }
        }
      }, 5000);
    });

    function playFunction() {
        playButton.classList.add('init-opacity-off');
        setTimeout(
          function(){
            playButton.classList.add('d-none');
            landscape.classList.add('opacity-on');
            info.classList.add('opacity-off');
            setTimeout(
              function(){
                document.getElementById("sectionMusic").innerHTML = "<div id='videoMusic'></div>";
                document.getElementById("sectionFx").innerHTML = "<div id='videoFx'></div>";
                document.getElementById("infoMusic").classList.remove('d-none');
                document.getElementById("infoFx").classList.remove('d-none');
                document.getElementById("lsButton").classList.remove('d-none');
                document.getElementById("player").classList.remove('d-none');

                // 2. This code loads the IFrame Player API code asynchronously.
                var tag = document.createElement('script');

                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
              }, 3000)
          }, 300);
    }

    // 3. This function creates an <iframe> (and YouTube player)
    //    after the API code downloads._j5QY5LbCOM
    var playerMusic;
    var playerFx;
    function onYouTubeIframeAPIReady() {
        playerMusic = new YT.Player('videoMusic', {
            width: '100%',
            videoId: 'IPSRJ0CBqBw',
            events: {
                'onReady': onPlayerMusicReady
            }
        });
        playerFx = new YT.Player('videoFx', {
            width: '100%',
            videoId: '_j5QY5LbCOM',
            events: {
                'onReady': onPlayerFxReady
            }
        });
    }

    // 4. The API will call this function when the video player is ready.
    function onPlayerMusicReady(event) {
        event.target.setVolume(90);
        event.target.seekTo(0);
        event.target.playVideo();
    }

    function onPlayerFxReady(event) {
        event.target.setVolume(60);
        event.target.seekTo(30);
        event.target.playVideo();
    }

    function pauseVideo() {
      if (isPlayingVideo) {
        playerMusic.pauseVideo();
        playerFx.pauseVideo();
        document.getElementById("togglePlayButton").src="img/play.png";
        lsVideo.pause();
        isPlayingVideo = false;
      } else {
        playerMusic.playVideo();
        playerFx.playVideo();
        document.getElementById("togglePlayButton").src="img/pause.png";
        lsVideo.play();
        isPlayingVideo = true;
      }
    }
</script>
</html>
